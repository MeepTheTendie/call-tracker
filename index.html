<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Call Tracker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #18181b;
      color: #f4f4f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      width: 100%;
      max-width: 380px;
    }
    .card {
      background: #27272a;
      border-radius: 20px;
      padding: 32px 24px;
      text-align: center;
    }
    .title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .shortcut {
      font-size: 12px;
      color: #71717a;
      margin-bottom: 28px;
    }
    .dials-label {
      font-size: 13px;
      color: #a1a1aa;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    .dials-count {
      font-size: 72px;
      font-weight: 700;
      color: #22c55e;
      margin-bottom: 24px;
    }
    .dials-count.complete { color: #eab308; }
    .today-box {
      background: #27272a;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
    }
    .today-label {
      font-size: 13px;
      color: #a1a1aa;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    .today-count {
      font-size: 48px;
      font-weight: 700;
      color: #fff;
    }
    .btn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      background: #22c55e;
      color: #18181b;
    }
    .btn:hover { background: #16a34a; }
    .btn:active { transform: scale(0.98); }
    .history {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #3f3f46;
    }
    .history-title {
      font-size: 13px;
      color: #71717a;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .clear-btn {
      background: none;
      border: 1px solid #3f3f46;
      color: #71717a;
      padding: 6px 12px;
      font-size: 11px;
      border-radius: 6px;
      cursor: pointer;
    }
    .call-list {
      max-height: 180px;
      overflow-y: auto;
    }
    .call-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      font-size: 14px;
      border-bottom: 1px solid #27272a;
    }
    .call-time { color: #a1a1aa; }
      .goal-progress {
        margin-top: 12px;
      }
      .goal-header {
        display: flex;
        justify-content: space-between;
        font-size: 11px;
        color: #71717a;
        margin-bottom: 4px;
      }
      .goal-bar {
        height: 6px;
        background: #3f3f46;
        border-radius: 3px;
        overflow: hidden;
      }
      .goal-fill {
        height: 100%;
        background: #22c55e;
        transition: width 0.3s;
      }
      .goal-fill.complete {
        background: #eab308;
      }
      .goal-text {
        font-size: 11px;
        color: #71717a;
        margin-top: 6px;
      }
      .goal-text.complete {
        color: #eab308;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <div class="title"><span role="img" aria-label="phone">ðŸ“ž</span> Call Tracker</div>
        <div class="shortcut">Win+Shift+C to log | Double-click index.html to open</div>

        <div class="dials-label">Dials Today</div>
        <div class="dials-count" id="today">0</div>

        <div class="today-box">
          <div class="goal-progress" id="goalProgress">
            <div class="goal-header">
              <span>Progress</span>
              <span id="goalPercent">0%</span>
            </div>
            <div class="goal-bar">
              <div class="goal-fill" id="goalFill" style="width: 0%"></div>
            </div>
            <div class="goal-text" id="goalText">80 more to reach goal</div>
          </div>
        </div>

      <button class="btn" id="logBtn">+1 Call</button>

      <div class="history">
        <div class="history-title">
          Recent Calls
          <button class="clear-btn" id="clearBtn">Clear</button>
        </div>
        <div class="call-list" id="callList"></div>
      </div>
    </div>
  </div>

  <script>
    const App = {
      calls: [],
      dailyGoal: 80,
      storage: null,
      elements: {},

      init() {
        try {
          this.storage = window.localStorage;
          this.cacheElements();
          this.load();
          this.render();
          this.bindEvents();
        } catch (error) {
          console.error('Failed to initialize app:', error);
          this.showErrorMessage('Failed to initialize app. Some features may not work.');
        }
      },

      cacheElements() {
        this.elements = {
          today: document.getElementById('today'),
          goalPercent: document.getElementById('goalPercent'),
          goalFill: document.getElementById('goalFill'),
          goalText: document.getElementById('goalText'),
          callList: document.getElementById('callList'),
          logBtn: document.getElementById('logBtn'),
          clearBtn: document.getElementById('clearBtn')
        };
      },

      load() {
        if (!this.storage) return;
        
        try {
          const saved = this.storage.getItem('callTracker');
          if (saved) {
            const data = JSON.parse(saved);
            this.calls = Array.isArray(data.calls) ? data.calls : [];
            this.dailyGoal = typeof data.dailyGoal === 'number' && data.dailyGoal > 0 ? data.dailyGoal : 80;
          }
        } catch (error) {
          console.warn('Failed to load saved data:', error);
          this.calls = [];
          this.dailyGoal = 80;
        }
      },

      save() {
        if (!this.storage) return;
        
        try {
          this.storage.setItem('callTracker', JSON.stringify({
            calls: this.calls,
            dailyGoal: this.dailyGoal
          }));
        } catch (error) {
          console.error('Failed to save data:', error);
          this.showErrorMessage('Failed to save data. Changes may not persist.');
        }
      },

      getTodayCalls() {
        const today = new Date().toDateString();
        return this.calls.filter(c => {
          try {
            return new Date(c.timestamp).toDateString() === today;
          } catch {
            return false;
          }
        }).length;
      },

      logCall() {
        try {
          const now = new Date();
          this.calls.push({ timestamp: now.toISOString() });
          this.save();
          this.render();
        } catch (error) {
          console.error('Failed to log call:', error);
          this.showErrorMessage('Failed to log call.');
        }
      },

      clearHistory() {
        try {
          if (confirm('Clear all calls? This cannot be undone.')) {
            this.calls = [];
            this.save();
            this.render();
          }
        } catch (error) {
          console.error('Failed to clear history:', error);
          this.showErrorMessage('Failed to clear history.');
        }
      },

      render() {
        try {
          const todayCount = this.getTodayCalls();
          
          // Update today's count
          this.elements.today.textContent = todayCount;
          this.elements.today.className = 'dials-count' + (todayCount >= this.dailyGoal ? ' complete' : '');
          
          const progress = Math.min(100, Math.round((todayCount / this.dailyGoal) * 100));
          const remaining = Math.max(0, this.dailyGoal - todayCount);
          const goalReached = todayCount >= this.dailyGoal;
          
          // Update progress
          this.elements.goalPercent.textContent = progress + '%';
          this.elements.goalFill.style.width = progress + '%';
          this.elements.goalFill.className = 'goal-fill' + (goalReached ? ' complete' : '');
          
          // Update goal text
          if (goalReached) {
            this.elements.goalText.innerHTML = 'Goal reached! <span role="img" aria-label="celebration">ðŸŽ‰</span>';
            this.elements.goalText.className = 'goal-text complete';
          } else {
            this.elements.goalText.textContent = remaining + ' more to reach goal';
            this.elements.goalText.className = 'goal-text';
          }
          
          // Update call list
          this.renderCallList();
        } catch (error) {
          console.error('Failed to render:', error);
          this.showErrorMessage('Failed to update display.');
        }
      },

      renderCallList() {
        const recent = this.calls.slice(-8).reverse();
        if (recent.length === 0) {
          this.elements.callList.innerHTML = '<div style="color:#52525b;text-align:center;padding:16px">No calls yet</div>';
          return;
        }
        
        this.elements.callList.innerHTML = recent.map(c => {
          try {
            const date = new Date(c.timestamp);
            return `<div class="call-item"><span class="call-time">${date.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true})}</span></div>`;
          } catch {
            return '<div class="call-item"><span class="call-time">Invalid time</span></div>';
          }
        }).join('');
      },

      showErrorMessage(message) {
        const existing = document.querySelector('.error-message');
        if (existing) existing.remove();
        
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #dc2626;
          color: white;
          padding: 12px 16px;
          border-radius: 8px;
          font-size: 14px;
          z-index: 1000;
          max-width: 300px;
        `;
        errorDiv.textContent = message;
        document.body.appendChild(errorDiv);
        
        setTimeout(() => {
          if (errorDiv.parentNode) {
            errorDiv.parentNode.removeChild(errorDiv);
          }
        }, 5000);
      },

      bindEvents() {
        try {
          this.elements.logBtn.onclick = () => this.logCall();
          this.elements.clearBtn.onclick = () => this.clearHistory();
          
          const handleKeydown = (e) => {
            try {
              if (e.key === 'c' && e.shiftKey && (e.metaKey || e.ctrlKey)) {
                e.preventDefault();
                this.logCall();
              }
            } catch (error) {
              console.error('Keyboard shortcut failed:', error);
            }
          };
          
          document.addEventListener('keydown', handleKeydown);
          
          // Store for cleanup
          this._cleanup = () => {
            document.removeEventListener('keydown', handleKeydown);
          };
        } catch (error) {
          console.error('Failed to bind events:', error);
        }
      }
    };

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => App.init());
    } else {
      App.init();
    }
  </script>
</body>
</html>
